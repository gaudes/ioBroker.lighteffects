{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["/*\n * Created with @iobroker/create-adapter v2.1.0\n */\n\n// The adapter-core module gives you access to the core ioBroker functions\n// you need to create an adapter\nimport * as utils from \"@iobroker/adapter-core\";\nimport { GlobalHelper } from \"./modules/global-helper\";\n\nlet Helper: GlobalHelper;\n\ninterface Light {\n\tname: string;\n\tenabled: boolean;\n\tstate: string;\n\tbrightness: string;\n\tcolor: string;\n\ttransition: string;\n\teffect: string;\n\tdisabling: string;\n\tverified: boolean;\n\tactive: boolean;\n}\n\nlet Lights: Light[];\n\nclass Lighteffects extends utils.Adapter {\n\t//#region Constructor\n\tpublic constructor(options: Partial<utils.AdapterOptions> = {}) {\n\t\tsuper({\n\t\t\t...options,\n\t\t\tname: \"lighteffects\",\n\t\t});\n\t\tthis.on(\"ready\", this.onReady.bind(this));\n\t\tthis.on(\"stateChange\", this.onStateChange.bind(this));\n\t\tthis.on(\"unload\", this.onUnload.bind(this));\n\t}\n\t//#endregion\n\n\t//#region Base Functions of Adapter\n\t//#region onReady\n\tprivate async onReady(): Promise<void> {\n\t\t// Init Helper\n\t\tHelper = new GlobalHelper(this);\n\t\t// Adapter starting\n\t\tHelper.ReportingInfo(\"Info\", \"Adapter\", \"Adapter starting\");\n\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", \"Current config: \" + JSON.stringify(this.config));\n\t\tLights = [];\n\t\t//#region Check config, create and cleanup states\n\t\t// Get existing states\n\t\tconst oExistingObjects = await this.getAdapterObjectsAsync();\n\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", \"Existing objects: \" + JSON.stringify(oExistingObjects));\n\t\tif (this.config.lights.length > 0) {\n\t\t\tfor (const cLight of this.config.lights) {\n\t\t\t\t// Creating internal object from config\n\t\t\t\tLights.push({\n\t\t\t\t\tname: cLight.name,\n\t\t\t\t\tenabled: cLight.enabled,\n\t\t\t\t\tstate: cLight.state,\n\t\t\t\t\tbrightness: cLight.brightness,\n\t\t\t\t\tcolor: cLight.color,\n\t\t\t\t\ttransition: cLight.transition,\n\t\t\t\t\teffect: cLight.effect,\n\t\t\t\t\tdisabling: cLight.disabling,\n\t\t\t\t\tverified: false,\n\t\t\t\t\tactive: false,\n\t\t\t\t});\n\n\t\t\t\t//#region Verify config element\n\t\t\t\tif (cLight.name === \"\" || cLight.name === null) {\n\t\t\t\t\tHelper.ReportingInfo(\"Warn\", \"Adapter\", \"Config contains light without name\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (cLight.state === \"\" || cLight.state === null) {\n\t\t\t\t\tHelper.ReportingInfo(\"Warn\", \"Adapter\", `Config light ${cLight.name} has no object for state`);\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tif ((await this.getForeignObjectAsync(cLight.state)) === null) {\n\t\t\t\t\t\tHelper.ReportingInfo(\n\t\t\t\t\t\t\t\"Warn\",\n\t\t\t\t\t\t\t\"Adapter\",\n\t\t\t\t\t\t\t`Config light ${cLight.name} has not existing object for state`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (cLight.brightness === \"\" || cLight.brightness === null) {\n\t\t\t\t\tHelper.ReportingInfo(\"Warn\", \"Adapter\", `Config light ${cLight.name} has no object for brightness`);\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tif ((await this.getForeignObjectAsync(cLight.brightness)) === null) {\n\t\t\t\t\t\tHelper.ReportingInfo(\n\t\t\t\t\t\t\t\"Warn\",\n\t\t\t\t\t\t\t\"Adapter\",\n\t\t\t\t\t\t\t`Config light ${cLight.name} has not existing object for brightness`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (cLight.color === \"\" || cLight.color === null) {\n\t\t\t\t\tHelper.ReportingInfo(\"Warn\", \"Adapter\", `Config light ${cLight.name} has no object for color`);\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tif ((await this.getForeignObjectAsync(cLight.color)) === null) {\n\t\t\t\t\t\tHelper.ReportingInfo(\n\t\t\t\t\t\t\t\"Warn\",\n\t\t\t\t\t\t\t\"Adapter\",\n\t\t\t\t\t\t\t`Config light ${cLight.name} has not existing object for color`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (cLight.transition === \"\" || cLight.transition === null) {\n\t\t\t\t\tHelper.ReportingInfo(\"Warn\", \"Adapter\", `Config light ${cLight.name} has no object for transition`);\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tif ((await this.getForeignObjectAsync(cLight.transition)) === null) {\n\t\t\t\t\t\tHelper.ReportingInfo(\n\t\t\t\t\t\t\t\"Warn\",\n\t\t\t\t\t\t\t\"Adapter\",\n\t\t\t\t\t\t\t`Config light ${cLight.name} has not existing object for transition`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Setting verified of internal object\n\t\t\t\tLights[Lights.findIndex((obj) => obj.name === cLight.name)].verified = true;\n\t\t\t\t//#endregion\n\n\t\t\t\t//#region Creating objects when enabled\n\t\t\t\tif (cLight.enabled === true) {\n\t\t\t\t\t// Checking or createing device\n\t\t\t\t\tif (oExistingObjects[this.name + \".\" + this.instance + \".\" + cLight.name]) {\n\t\t\t\t\t\t// Already exists\n\t\t\t\t\t\tdelete oExistingObjects[this.name + \".\" + this.instance + \".\" + cLight.name];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Create device\n\t\t\t\t\t\tawait this.createDeviceAsync(cLight.name);\n\t\t\t\t\t}\n\t\t\t\t\t// Checking or createing effect\n\t\t\t\t\tif (oExistingObjects[this.name + \".\" + this.instance + \".\" + cLight.name + \".\" + \"effect\"]) {\n\t\t\t\t\t\t// Already exists\n\t\t\t\t\t\tdelete oExistingObjects[this.name + \".\" + this.instance + \".\" + cLight.name + \".\" + \"effect\"];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Create State\n\t\t\t\t\t\tawait this.setObjectNotExistsAsync(cLight.name + \".\" + \"effect\", {\n\t\t\t\t\t\t\ttype: \"state\",\n\t\t\t\t\t\t\tcommon: {\n\t\t\t\t\t\t\t\tname: \"effect\",\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\trole: \"state\",\n\t\t\t\t\t\t\t\tstates: { color: \"color\", candle: \"candle\", alarm: \"alarm\" },\n\t\t\t\t\t\t\t\tread: true,\n\t\t\t\t\t\t\t\twrite: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tnative: {},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t// Checking or createing state\n\t\t\t\t\tif (oExistingObjects[this.name + \".\" + this.instance + \".\" + cLight.name + \".\" + \"state\"]) {\n\t\t\t\t\t\t// Already exists\n\t\t\t\t\t\tdelete oExistingObjects[this.name + \".\" + this.instance + \".\" + cLight.name + \".\" + \"state\"];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Create State\n\t\t\t\t\t\tawait this.setObjectNotExistsAsync(cLight.name + \".\" + \"state\", {\n\t\t\t\t\t\t\ttype: \"state\",\n\t\t\t\t\t\t\tcommon: {\n\t\t\t\t\t\t\t\tname: \"state\",\n\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\trole: \"state\",\n\t\t\t\t\t\t\t\tread: true,\n\t\t\t\t\t\t\t\twrite: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tnative: {},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//#endregion\n\n\t\t\t\t//#region Cleanup state and subscribe object\n\t\t\t\tawait this.setStateAsync(cLight.name + \".\" + \"state\", false);\n\t\t\t\tawait this.setStateAsync(cLight.name + \".\" + \"effect\", cLight.effect);\n\t\t\t\tthis.subscribeStates(cLight.name + \".\" + \"state\");\n\t\t\t\tthis.subscribeStates(cLight.name + \".\" + \"effect\");\n\t\t\t\t//#endregion\n\t\t\t}\n\n\t\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", `Internal Lights object: ${JSON.stringify(Lights)}`);\n\n\t\t\t//#region Cleaning up reminding objects\n\t\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", `Objects to cleanup: ${JSON.stringify(oExistingObjects)}`);\n\t\t\tObject.entries(oExistingObjects).map(([key, _value]) => {\n\t\t\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", `Deleting unneeded object ${key}`);\n\t\t\t\tthis.delForeignObjectAsync(key);\n\t\t\t});\n\t\t\t//#endregion\n\t\t}\n\t\t//#endregion\n\t}\n\t//#endregion\n\n\t//#region onUnload\n\tprivate onUnload(callback: () => void): void {\n\t\ttry {\n\t\t\tcallback();\n\t\t} catch (e) {\n\t\t\tcallback();\n\t\t}\n\t}\n\t//#endregion\n\n\t//#region onStateChange\n\tprivate onStateChange(id: string, state: ioBroker.State | null | undefined): void {\n\t\tif (state) {\n\t\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", `state ${id} changed: ${state.val} (ack = ${state.ack})`);\n\t\t\t// Get Name of Config Light\n\t\t\tconst LightName = id.split(\".\")[2];\n\t\t\t// Get object name for light\n\t\t\tconst ChangedProperty = id.split(\".\")[3];\n\t\t\tif (ChangedProperty === \"effect\") {\n\t\t\t\tLights[Lights.findIndex((obj) => obj.name === LightName)].effect === state.val;\n\t\t\t\tif (Lights[Lights.findIndex((obj) => obj.name === LightName)].active === true) {\n\t\t\t\t\t// CHANGE EFFECT\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ChangedProperty === \"state\") {\n\t\t\t\t// Enable effect\n\t\t\t\tif (state.val === true) {\n\t\t\t\t\tswitch (Lights[Lights.findIndex((obj) => obj.name === LightName)].effect) {\n\t\t\t\t\t\tcase \"alarm\":\n\t\t\t\t\t\t\tthis.effectAlarm(LightName);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tLights[Lights.findIndex((obj) => obj.name === LightName)].active = false;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", `state ${id} deleted`);\n\t\t}\n\t}\n\t//#endregion\n\t//#endregion\n\n\t//#region Effect Functions\n\n\t//#region Effect Alarm\n\tprivate effectAlarm(LightName: string): void {\n\t\tHelper.ReportingInfo(\"Info\", \"Adapter\", `Effect alarm for ${LightName}`);\n\t\tLights[Lights.findIndex((obj) => obj.name === LightName)].active = true;\n\t}\n\t//#endregion\n\n\t//#endregion\n}\n\nif (require.main !== module) {\n\t// Export the constructor in compact mode\n\tmodule.exports = (options: Partial<utils.AdapterOptions> | undefined) => new Lighteffects(options);\n} else {\n\t// otherwise start the instance directly\n\t(() => new Lighteffects())();\n}\n"],
  "mappings": "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",
  "names": []
}
